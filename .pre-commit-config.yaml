repos:
  # ============================================================================
  # BASIC FILE QUALITY CHECKS (baseline hygiene)
  # ============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ["--maxkb=1000"]
      - id: check-merge-conflict
      - id: check-toml
      - id: check-json
      - id: mixed-line-ending
        args: ["--fix=lf"]
      - id: check-case-conflict
      - id: check-docstring-first
      - id: check-ast
      - id: debug-statements
      - id: name-tests-test
        args: ["--pytest-test-first"]

  # ============================================================================
  # CODE FORMATTING (minimal - consistency only, not quality)
  # ============================================================================
  - repo: https://github.com/psf/black
    rev: 25.9.0
    hooks:
      - id: black
        language_version: python3

  - repo: https://github.com/pycqa/isort
    rev: 6.1.0
    hooks:
      - id: isort

  # ============================================================================
  # TESTING (full test suite)
  # Evidence: Integration tests catch 60% more defects than unit tests alone
  # Runs ALL tests to catch breaking changes before commit
  # ============================================================================
  - repo: local
    hooks:
      - id: pytest-all
        name: pytest (all tests)
        entry: ./.pre-commit-pytest.sh
        language: script
        types: [python]
        args:
          [
            "tests/",
            "-v",
            "--tb=short",
          ]
        pass_filenames: false
        always_run: true

  # ============================================================================
  # STATIC TYPING (proven to reduce TypeError/AttributeError in production)
  # Evidence: Dropbox/Instagram case studies show 15-40% reduction in type errors
  # ============================================================================
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.18.2
    hooks:
      - id: mypy
        name: mypy (strict mode for code health)
        additional_dependencies:
          ["types-PyYAML", "types-aiofiles", "types-colorama", "types-requests", "pytest", "pytest-asyncio"]
        files: ^src/

  # ============================================================================
  # SECURITY & VULNERABILITY DETECTION
  # Evidence: CVE databases with reproducible advisories
  # ============================================================================
  - repo: https://github.com/trailofbits/pip-audit
    rev: v2.9.0
    hooks:
      - id: pip-audit
        name: pip-audit (CVE detection in dependencies)
        args:
          [
            "--desc",
            "on",
            "--skip-editable",
            "--ignore-vuln",
            "GHSA-4xh5-x5gv-qwph",
          ]

  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args: ["--baseline", ".secrets.baseline"]

  # ============================================================================
  # SEMANTIC SECURITY ANALYSIS (replaces basic Bandit)
  # Evidence: Testable rulepacks, widely adopted in SAST programs
  # ============================================================================
  - repo: https://github.com/returntocorp/semgrep
    rev: v1.89.0
    hooks:
      - id: semgrep
        name: semgrep (AST-based security & policy)
        args:
          [
            "--config=p/security-audit",
            "--config=p/python",
            "--error",
            "--skip-unknown-extensions",
            "--metrics=off",
          ]
        files: ^src/

  # ============================================================================
  # DEAD CODE DETECTION (reduces attack surface & maintenance burden)
  # Evidence: Direct verification - unused code is measurably wasteful
  # ============================================================================
  - repo: https://github.com/jendrikseipp/vulture
    rev: v2.14
    hooks:
      - id: vulture
        name: vulture (dead code)
        args: ["--min-confidence=80", "src/"]
        files: ^src/
        pass_filenames: false

  # ============================================================================
  # CODE DUPLICATION DETECTION (reduces maintenance burden & bug propagation)
  # Evidence: Studies show duplicated code increases bug density by 2-3x
  # Detects copy-pasted code blocks that should be refactored into functions
  # ============================================================================
  - repo: https://github.com/PyCQA/pylint
    rev: v3.3.4
    hooks:
      - id: pylint
        name: pylint (duplicate code detection)
        args:
          [
            "--disable=all",
            "--enable=duplicate-code",
            "--min-similarity-lines=6",
            "--ignore-comments=yes",
            "--ignore-docstrings=yes",
            "--ignore-imports=yes",
          ]
        files: ^src/
        additional_dependencies: ["types-PyYAML", "types-aiofiles", "types-colorama", "types-requests"]

  # ============================================================================
  # LINTING (focused on correctness, not style)
  # Using Ruff for speed; flake8 removed to avoid redundancy
  # ============================================================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.13.3
    hooks:
      - id: ruff
        name: ruff (correctness-focused checks)
        args: ["--fix", "--unsafe-fixes"]

  # ============================================================================
  # SPELL CHECKING (reduces documentation defects)
  # ============================================================================
  - repo: https://github.com/codespell-project/codespell
    rev: v2.4.1
    hooks:
      - id: codespell
        args:
          ["--write-changes", "--ignore-words-list=crate,nd,ser,llm,async,cli,theses"]
        exclude: ^(\.git/|\.venv/|venv/)

  # ============================================================================
  # YAML/JSON LINTING
  # ============================================================================
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint
        args:
          - "-d"
          - >-
            {extends: default, rules:
            {line-length: {max: 120}, document-start: disable,
            indentation: disable, comments: disable}}

  # ============================================================================
  # COMMIT MESSAGE QUALITY
  # ============================================================================
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v4.9.1
    hooks:
      - id: commitizen
        stages: [commit-msg]

# ============================================================================
# TESTING IN PRE-COMMIT VS CI
# ============================================================================
# PRE-COMMIT (fast integration tests):
# - tests/integration/test_tournament_behavior.py (13 tests, ~0.1s)
# - tests/integration/test_prompt_system.py (19 tests, ~0.1s)
# - tests/unit/test_smoke_tournament.py (2 tests, ~0.05s)
# Total: 34 tests in ~0.2s - fast feedback on core behavior
#
# CI ONLY (comprehensive test suite):
# - All integration tests (100+ tests)
# - E2E tests with real scenarios
# - Performance benchmarks
# - Coverage analysis (pytest-cov)
# - Mutation testing (mutmut/Cosmic Ray)
# - Property-based testing (Hypothesis)
#
# ============================================================================
# OTHER TOOLS DEFERRED TO CI (too slow or complex for pre-commit)
# ============================================================================
# - CodeQL: GitHub-specific, requires workflow setup
# - Pysa: Requires framework-specific taint configuration
# - SonarQube/Cloud: Platform-based, not a hook
# - Radon: No official pre-commit hook, run via pip in CI
# - Import Linter: Requires project-specific contract definition
# - Atheris/CrossHair: Fuzzing/symbolic execution - CI only
#
# See .github/workflows/ci.yml for integration of these tools
